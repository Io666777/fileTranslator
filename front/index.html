<!DOCTYPE html>
<html>
<head>
    <title>File Translator</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 40px auto; padding: 20px; }
        .container { margin-bottom: 20px; }
        input, button, textarea { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .file-item { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>üìÅ File Translator</h1>

    <!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -->
    <div id="auth-section">
        <div class="container">
            <h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="signUp()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            <button onclick="signIn()">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª -->
    <div id="main-section" class="hidden">
        <button onclick="logout()">–í—ã–π—Ç–∏</button>
        
        <div class="container">
            <h3>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</h3>
            <input type="file" id="file-input">
            <button onclick="uploadFile()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>

        <div class="container">
            <h3>–ú–æ–∏ —Ñ–∞–π–ª—ã</h3>
            <div id="files-list"></div>
        </div>
    </div>

    <script>
        let token = localStorage.getItem('token');
        
        if (token) {
            showMainSection();
        }

        function showMainSection() {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('main-section').classList.remove('hidden');
            loadFiles();
        }

        async function signUp() {
            const user = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                name: document.getElementById('username').value
            };

            const response = await fetch('/auth/sign-up', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(user)
            });

            alert(response.ok ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!' : '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
        }

        async function signIn() {
            const credentials = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value
            };

            const response = await fetch('/auth/sign-in', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(credentials)
            });

            if (response.ok) {
                const data = await response.json();
                token = data.token;
                localStorage.setItem('token', token);
                showMainSection();
            } else {
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
            }
        }

        async function uploadFile() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch('/api/files/upload', {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token },
                body: formData
            });

            if (response.ok) {
                alert('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!');
                fileInput.value = '';
                loadFiles();
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            }
        }

        async function loadFiles() {
            const response = await fetch('/api/files/', {
                headers: { 'Authorization': 'Bearer ' + token }
            });

            if (response.ok) {
                const files = await response.json();
                displayFiles(files);
            }
        }

        function displayFiles(files) {
            const filesList = document.getElementById('files-list');
            filesList.innerHTML = '';

            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <strong>${file.title}</strong> (${file.status})
                    <br>
                    <button onclick="downloadFile(${file.id})">–°–∫–∞—á–∞—Ç—å</button>
                    <button onclick="translateFile(${file.id})">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                    <button onclick="deleteFile(${file.id})">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                filesList.appendChild(fileItem);
            });
        }

        async function translateFile(fileId) {
            const response = await fetch(`/api/files/${fileId}/translate`, {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token }
            });

            if (response.ok) {
                alert('–ü–µ—Ä–µ–≤–æ–¥ –∑–∞–ø—É—â–µ–Ω!');
                loadFiles();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞');
            }
        }

        async function downloadFile(fileId) {
            const response = await fetch(`/api/files/${fileId}/download`, {
                headers: { 'Authorization': 'Bearer ' + token }
            });

            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `file_${fileId}`;
                a.click();
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
            }
        }

        async function deleteFile(fileId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?')) return;

            const response = await fetch(`/api/files/${fileId}`, {
                method: 'DELETE',
                headers: { 'Authorization': 'Bearer ' + token }
            });

            if (response.ok) {
                alert('–§–∞–π–ª —É–¥–∞–ª–µ–Ω');
                loadFiles();
            } else {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            token = null;
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('main-section').classList.add('hidden');
        }
    </script>
</body>
</html>